<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="py-8 md:py-12 text-center px-4" style="background-color: #EDE9FE;">
        <div
            class="w-12 h-12 md:w-16 md:h-16 bg-white/40 rounded-2xl flex items-center justify-center mx-auto mb-3 md:mb-4">
            <i class="fa-solid fa-scissors text-2xl md:text-3xl" style="color: #7C3AED;"></i>
        </div>
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Split PDF File</h1>
        <p class="text-gray-600 text-sm md:text-base">Split PDF into multiple files with advanced options</p>
    </div>

    <div class="container mx-auto px-3 md:px-4 py-6 md:py-12">

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
            <!-- Left Panel: Controls -->
            <div class="lg:col-span-1 space-y-4">
                <!-- Upload Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="font-bold text-lg text-gray-900 mb-4">Upload PDF</h2>

                    <!-- File Input with Drag & Drop -->
                    <input #fileInput type="file" accept=".pdf" (change)="onFileSelect($event)" class="hidden">

                    <div (click)="triggerFileInput()" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)"
                        (drop)="onDrop($event)"
                        class="upload-zone border-2 border-dashed rounded-xl p-6 md:p-8 text-center transition-all cursor-pointer"
                        [class.border-primary]="isDragOver()" [class.bg-purple-50]="isDragOver()"
                        [class.border-gray-300]="!isDragOver()">
                        <i class="fa-solid fa-cloud-arrow-up text-4xl mb-3" [class.text-primary]="isDragOver()"
                            [class.text-gray-400]="!isDragOver()"></i>
                        <p class="text-gray-600">Click to upload PDF</p>
                        <p class="text-gray-400 text-sm mt-1">or drag and drop</p>
                    </div>

                    @if (fileName) {
                    <div class="mt-4 flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-file-pdf text-red-500"></i>
                            <span class="text-sm text-gray-700 truncate max-w-[150px]">{{ fileName }}.pdf</span>
                        </div>
                        <button (click)="resetTool()" class="text-gray-400 hover:text-red-500">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                    }
                </div>

                @if (totalPages() > 0) {
                <!-- Split Mode Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="font-bold text-lg text-gray-900 mb-4">What do you want to do?</h2>

                    <!-- Main Choice: Separate vs Single -->
                    <div class="space-y-3 mb-4">
                        <button (click)="setSplitMode('extractSingle')"
                            class="w-full p-4 rounded-xl border-2 text-left transition-all"
                            [class.border-primary]="splitMode() === 'extractSingle'"
                            [class.bg-purple-50]="splitMode() === 'extractSingle'"
                            [class.border-gray-200]="splitMode() !== 'extractSingle'">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                                    [class.bg-primary]="splitMode() === 'extractSingle'"
                                    [class.text-white]="splitMode() === 'extractSingle'"
                                    [class.bg-gray-100]="splitMode() !== 'extractSingle'">
                                    <i class="fa-solid fa-file-circle-plus"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-900">Merge into Single PDF</p>
                                    <p class="text-xs text-gray-500">Combine selected pages into ONE PDF file</p>
                                </div>
                            </div>
                        </button>

                        <button (click)="setSplitMode('individual')"
                            class="w-full p-4 rounded-xl border-2 text-left transition-all"
                            [class.border-primary]="splitMode() === 'individual'"
                            [class.bg-purple-50]="splitMode() === 'individual'"
                            [class.border-gray-200]="splitMode() !== 'individual'">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                                    [class.bg-primary]="splitMode() === 'individual'"
                                    [class.text-white]="splitMode() === 'individual'"
                                    [class.bg-gray-100]="splitMode() !== 'individual'">
                                    <i class="fa-solid fa-files-medical"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-900">Split into Separate PDFs</p>
                                    <p class="text-xs text-gray-500">Each selected page becomes its own PDF</p>
                                </div>
                            </div>
                        </button>
                    </div>

                    <!-- Advanced Options Toggle -->
                    <button (click)="showAdvanced.set(!showAdvanced())"
                        class="text-sm text-primary hover:underline flex items-center gap-1">
                        <i class="fa-solid" [class.fa-chevron-down]="!showAdvanced()"
                            [class.fa-chevron-up]="showAdvanced()"></i>
                        Advanced Options
                    </button>

                    @if (showAdvanced()) {
                    <div class="mt-4 pt-4 border-t space-y-3">
                        <button (click)="setSplitMode('ranges')"
                            class="w-full p-3 rounded-lg border text-left transition-all text-sm"
                            [class.border-primary]="splitMode() === 'ranges'"
                            [class.bg-purple-50]="splitMode() === 'ranges'"
                            [class.border-gray-200]="splitMode() !== 'ranges'">
                            <i class="fa-solid fa-layer-group mr-2"></i>
                            <strong>Custom Ranges</strong> - e.g., pages 1-5, 8-12
                        </button>

                        <button (click)="setSplitMode('equalParts')"
                            class="w-full p-3 rounded-lg border text-left transition-all text-sm"
                            [class.border-primary]="splitMode() === 'equalParts'"
                            [class.bg-purple-50]="splitMode() === 'equalParts'"
                            [class.border-gray-200]="splitMode() !== 'equalParts'">
                            <i class="fa-solid fa-grip mr-2"></i>
                            <strong>Equal Parts</strong> - Split into N equal chunks
                        </button>

                        @if (splitMode() === 'ranges') {
                        <div class="mt-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Page Ranges</label>
                            <input type="text" [value]="rangeInput()"
                                (input)="rangeInput.set($any($event.target).value)" placeholder="e.g., 1-5, 8, 10-15"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-primary">
                            <p class="text-xs text-gray-500 mt-1">Each range creates a separate PDF</p>
                        </div>
                        }

                        @if (splitMode() === 'equalParts') {
                        <div class="mt-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Number of Parts</label>
                            <input type="number" [value]="equalParts()"
                                (input)="equalParts.set(+$any($event.target).value)" [min]="1" [max]="totalPages()"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-primary">
                            <p class="text-xs text-gray-500 mt-1">{{ totalPages() }} pages รท {{ equalParts() }} = ~{{
                                (totalPages() / equalParts()) | number:'1.0-0' }} pages each</p>
                        </div>
                        }
                    </div>
                    }

                    <!-- Estimated Output -->
                    <div class="mt-4 p-3 rounded-lg" [class.bg-green-50]="splitMode() === 'extractSingle'"
                        [class.bg-purple-50]="splitMode() !== 'extractSingle'">
                        <p class="text-sm" [class.text-green-700]="splitMode() === 'extractSingle'"
                            [class.text-purple-700]="splitMode() !== 'extractSingle'">
                            <i class="fa-solid mr-1" [class.fa-file]="splitMode() === 'extractSingle'"
                                [class.fa-files-medical]="splitMode() !== 'extractSingle'"></i>
                            Output: <strong>{{ getEstimatedOutput() }}</strong>
                        </p>
                    </div>
                </div>

                <!-- Page Selection Section -->
                @if (splitMode() === 'individual' || splitMode() === 'extractSingle') {
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="font-bold text-lg text-gray-900 mb-4">Select Pages</h2>

                    <!-- Quick Select Buttons -->
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <button (click)="selectAll()" class="px-3 py-2 rounded-lg text-sm transition-colors"
                            [class.bg-primary]="isAllSelected()" [class.text-white]="isAllSelected()"
                            [class.bg-gray-100]="!isAllSelected()" [class.hover:bg-gray-200]="!isAllSelected()">
                            <i class="fa-solid fa-check-double mr-1"></i> All
                        </button>
                        <button (click)="deselectAll()" class="px-3 py-2 rounded-lg text-sm transition-colors"
                            [class.bg-primary]="isNoneSelected()" [class.text-white]="isNoneSelected()"
                            [class.bg-gray-100]="!isNoneSelected()" [class.hover:bg-gray-200]="!isNoneSelected()">
                            <i class="fa-solid fa-xmark mr-1"></i> None
                        </button>
                        <button (click)="selectOdd()" class="px-3 py-2 rounded-lg text-sm transition-colors"
                            [class.bg-primary]="isOddSelected()" [class.text-white]="isOddSelected()"
                            [class.bg-gray-100]="!isOddSelected()" [class.hover:bg-gray-200]="!isOddSelected()">
                            <i class="fa-solid fa-1 mr-1"></i> Odd
                        </button>
                        <button (click)="selectEven()" class="px-3 py-2 rounded-lg text-sm transition-colors"
                            [class.bg-primary]="isEvenSelected()" [class.text-white]="isEvenSelected()"
                            [class.bg-gray-100]="!isEvenSelected()" [class.hover:bg-gray-200]="!isEvenSelected()">
                            <i class="fa-solid fa-2 mr-1"></i> Even
                        </button>
                    </div>

                    <button (click)="invertSelection()"
                        class="w-full px-3 py-2 bg-gray-600 text-white rounded-lg text-sm mb-4 hover:bg-gray-700 transition-colors">
                        <i class="fa-solid fa-repeat mr-1"></i> Invert Selection
                    </button>

                    <!-- Range Selector -->
                    <div class="border-t pt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Add Range</label>
                        <div class="flex gap-2 items-center">
                            <input type="number" [value]="rangeStart()"
                                (input)="rangeStart.set(+$any($event.target).value)" [min]="1" [max]="totalPages()"
                                class="w-20 px-2 py-1 border border-gray-300 rounded text-sm text-center">
                            <span class="text-gray-500">to</span>
                            <input type="number" [value]="rangeEnd()" (input)="rangeEnd.set(+$any($event.target).value)"
                                [min]="1" [max]="totalPages()"
                                class="w-20 px-2 py-1 border border-gray-300 rounded text-sm text-center">
                            <button (click)="applyRange()"
                                class="px-3 py-1 bg-primary text-white rounded text-sm hover:bg-purple-600">
                                Add
                            </button>
                        </div>
                    </div>
                </div>
                }

                <!-- Download Options -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="font-bold text-lg text-gray-900 mb-4">Output Options</h2>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">File Name Prefix</label>
                        <input type="text" [value]="customPrefix()"
                            (input)="customPrefix.set($any($event.target).value)" placeholder="split"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>

                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="zipDownload" [checked]="downloadAsZip()"
                            (change)="downloadAsZip.set($any($event.target).checked)"
                            class="rounded border-gray-300 text-primary focus:ring-primary">
                        <label for="zipDownload" class="text-sm text-gray-700">Download as ZIP</label>
                    </div>

                    <!-- Split Button -->
                    <button (click)="splitPdf()" [disabled]="!canSplit() || isProcessing()"
                        class="w-full mt-6 px-4 py-3 bg-primary text-white rounded-lg font-medium hover:bg-purple-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        @if (isProcessing()) {
                        <i class="fa-solid fa-spinner fa-spin mr-2"></i> Processing...
                        } @else {
                        <i class="fa-solid fa-scissors mr-2"></i> Split PDF
                        }
                    </button>
                </div>

                @if (status()) {
                <div class="p-4 rounded-lg" [class.bg-green-50]="status().includes('Success')"
                    [class.text-green-700]="status().includes('Success')"
                    [class.bg-blue-50]="!status().includes('Success') && !status().includes('Error')"
                    [class.text-blue-700]="!status().includes('Success') && !status().includes('Error')"
                    [class.bg-red-50]="status().includes('Error')" [class.text-red-700]="status().includes('Error')">
                    <p class="text-sm">{{ status() }}</p>
                </div>
                }

                <!-- Download and Tool Chaining buttons after split -->
                @if (splitCompleted() && pendingFiles().length > 0) {
                <div class="mt-4 flex flex-col md:flex-row gap-3 items-center">
                    <!-- Download Button -->
                    <button (click)="downloadOutput()"
                        class="flex-1 w-full px-4 py-3 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition-colors flex items-center justify-center gap-2">
                        <i class="fa-solid fa-download"></i>
                        Download {{ pendingFiles().length > 1 ? pendingFiles().length + ' PDFs' : 'PDF' }}
                    </button>

                    <!-- Send to Tool -->
                    <div class="w-full md:w-auto md:flex-1">
                        <app-send-to-tool [hasOutput]="splitCompleted()" [currentRoute]="'/pdf/split'"
                            [outputData]="lastOutputData()" [fileName]="lastOutputFileName()" [fileType]="'pdf'">
                        </app-send-to-tool>
                    </div>
                </div>
                }
                }
            </div>

            <!-- Right Panel: Preview -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6 sticky top-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="font-bold text-lg text-gray-900">Page Preview</h2>
                        @if (totalPages() > 0) {
                        <div class="flex items-center gap-3">
                            <span class="text-sm text-gray-500">{{ selectedPages().size }} selected</span>
                            <span class="text-gray-300">|</span>
                            <span class="text-gray-500 text-sm">Total: {{ totalPages() }} pages</span>
                        </div>
                        }
                    </div>

                    @if (isLoading()) {
                    <div class="flex flex-col items-center justify-center h-64">
                        <i class="fa-solid fa-spinner fa-spin text-4xl text-primary mb-4"></i>
                        <p class="text-gray-500">Loading PDF...</p>
                    </div>
                    } @else if (previews().length > 0) {
                    <div
                        class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 md:gap-3 max-h-[400px] md:max-h-[600px] overflow-y-auto p-2">
                        @for (preview of previews(); track $index; let i = $index) {
                        <div (click)="togglePage(i)"
                            class="page-preview relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all hover:shadow-lg"
                            [class.border-primary]="isPageSelected(i)" [class.border-gray-200]="!isPageSelected(i)"
                            [class.ring-2]="isPageSelected(i)" [class.ring-primary]="isPageSelected(i)"
                            [class.ring-offset-1]="isPageSelected(i)"
                            [class.opacity-60]="splitMode() === 'ranges' || splitMode() === 'equalParts'">
                            <img [src]="preview" [alt]="'Page ' + (i + 1)" class="w-full h-auto">
                            @if (isPageSelected(i)) {
                            <div
                                class="absolute top-1 right-1 w-5 h-5 bg-primary rounded-full flex items-center justify-center shadow">
                                <i class="fa-solid fa-check text-white text-xs"></i>
                            </div>
                            }
                            <div
                                class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white text-xs text-center py-2">
                                Page {{ i + 1 }}
                            </div>
                        </div>
                        }
                    </div>
                    } @else {
                    <div class="flex flex-col items-center justify-center h-64 text-gray-400">
                        <i class="fa-solid fa-file-pdf text-5xl mb-3"></i>
                        <p>Upload a PDF to see page previews</p>
                    </div>
                    }
                </div>
            </div>
        </div>

        <!-- SEO Content -->
        <article class="prose lg:prose-xl mx-auto mt-16 px-4 max-w-4xl">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Split PDF Files Online - Extract Pages for Free</h1>
            <p class="text-gray-600 mb-8 leading-relaxed">
                Separate PDF pages or extract specific pages from your documents instantly. Our free PDF splitter allows
                you to cut PDF files, detailed page selection, and more.
            </p>

            <h2 class="text-2xl font-bold text-gray-800 mb-4">How to Split a PDF?</h2>
            <ol class="list-decimal pl-6 mb-8 space-y-2 text-gray-600">
                <li><strong>Upload PDF:</strong> Select via file picker or drag and drop.</li>
                <li><strong>Select Pages:</strong> Click on the pages you want to extract or enter a range (e.g., 1-5).
                </li>
                <li><strong>Choose Mode:</strong> Split into individual files, ranges, or extract to a single new PDF.
                </li>
                <li><strong>Download:</strong> Save your separated PDF files instantly.</li>
            </ol>

            <h2 class="text-2xl font-bold text-gray-800 mb-4">Powerful Splitting Options</h2>
            <ul class="list-disc pl-6 mb-8 space-y-2 text-gray-600">
                <li><strong>Visual Selection:</strong> See previews of every page to select exactly what you need.</li>
                <li><strong>Range Splitting:</strong> extracting large chunks of documents (e.g., Chapters 1-3).</li>
                <li><strong>Extract to Single:</strong> Pick specific pages and merge them into a new document.</li>
                <li><strong>Secure:</strong> All processing happens safely, ensuring your data privacy.</li>
            </ul>

            <h2 class="text-2xl font-bold text-gray-800 mb-4">Frequently Asked Questions</h2>
            <div class="space-y-4">
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-2">Can I extract just one page?</h3>
                    <p class="text-gray-600">Yes! Just select that single page and choose "Extract to Single PDF".</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-2">Is there a file size limit?</h3>
                    <p class="text-gray-600">We support large files, but browser memory limits may apply for extremely
                        large documents.</p>
                </div>
            </div>
        </article>
    </div>
</div>