<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="py-12 text-center" style="background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);">
        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
            <i class="fa-solid fa-expand text-3xl text-white"></i>
        </div>
        <h1 class="text-3xl font-bold text-white mb-2">Resize Image</h1>
        <p class="text-white/80">Resize images to any dimension with precision</p>
    </div>

    <div class="container mx-auto px-4 max-w-5xl py-12">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="p-8 md:p-12">

                <!-- Upload Area -->
                @if (!originalImage) {
                <div class="border-3 border-dashed border-gray-200 rounded-2xl p-10 text-center transition-all duration-300 hover:border-purple-400 hover:bg-purple-50/50 cursor-pointer"
                    (dragover)="onDragOver($event)" (drop)="onDrop($event)" (click)="fileInput.click()">
                    <input #fileInput type="file" accept="image/*" class="hidden" (change)="onFileSelected($event)">
                    <div class="flex flex-col items-center justify-center space-y-4">
                        <div
                            class="w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center text-purple-500 mb-2">
                            <i class="fa-solid fa-expand text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Drag & Drop image here</h3>
                        <p class="text-gray-500">or <span class="text-purple-500 font-semibold hover:underline">browse
                                files</span> from your computer</p>
                        <p class="text-xs text-gray-400 mt-2">Supports JPG, PNG, WebP</p>
                    </div>
                </div>
                }

                <!-- Position Editor Modal -->
                @if (showPositionEditor) {
                <div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">
                            <i class="fa-solid fa-hand-pointer text-purple-500 mr-2"></i>
                            Position Your Image
                        </h3>
                        <p class="text-gray-500 text-sm mb-4">Drag the image to adjust its position within the frame</p>

                        <!-- Canvas for positioning -->
                        <div class="flex justify-center mb-4">
                            <canvas #positionCanvas class="cursor-move rounded-lg shadow-lg" style="max-width: 100%;"
                                (mousedown)="onCanvasMouseDown($event)" (mousemove)="onCanvasMouseMove($event)"
                                (mouseup)="onCanvasMouseUp()" (mouseleave)="onCanvasMouseLeave()"
                                (touchstart)="onCanvasTouchStart($event)" (touchmove)="onCanvasTouchMove($event)"
                                (touchend)="onCanvasTouchEnd()">
                            </canvas>
                        </div>

                        <p class="text-center text-sm text-gray-400 mb-4">
                            <i class="fa-solid fa-arrows-up-down-left-right mr-1"></i>
                            Drag to move • Target: {{ formatDimensions(targetWidth, targetHeight) }}
                        </p>

                        <div class="flex gap-3 justify-center">
                            <button (click)="cancelPositionEditor()"
                                class="px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors">
                                Cancel
                            </button>
                            <button (click)="confirmPosition()"
                                class="px-6 py-2.5 bg-gradient-to-r from-purple-500 to-violet-500 text-white rounded-lg font-bold hover:from-purple-600 hover:to-violet-600 transition-all">
                                <i class="fa-solid fa-check mr-1"></i> Apply & Resize
                            </button>
                        </div>
                    </div>
                </div>
                }

                <!-- Controls & Preview -->
                @if (originalImage && !showPositionEditor) {
                <div class="space-y-6">

                    <!-- Original Info -->
                    <div class="bg-gray-50 rounded-xl p-4 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-image text-gray-400"></i>
                            <span class="font-medium text-gray-700">{{ originalFileName }}</span>
                        </div>
                        <span class="text-gray-500">Original: {{ formatDimensions(originalWidth, originalHeight)
                            }}</span>
                    </div>

                    <!-- Dimension Controls -->
                    <div class="bg-purple-50 rounded-xl p-6">
                        <h3 class="font-bold text-gray-800 mb-4">New Dimensions</h3>

                        <div class="flex items-center gap-4 mb-4">
                            <!-- Width -->
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-600 mb-1">Width (px)</label>
                                <input type="number" [(ngModel)]="targetWidth" (ngModelChange)="onWidthChange()"
                                    class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg font-medium"
                                    min="1" max="10000">
                            </div>

                            <!-- Lock Button -->
                            <button (click)="toggleAspectRatio()"
                                class="mt-6 w-12 h-12 rounded-full flex items-center justify-center transition-colors"
                                [class.bg-purple-500]="aspectRatioLocked" [class.text-white]="aspectRatioLocked"
                                [class.bg-gray-200]="!aspectRatioLocked" [class.text-gray-500]="!aspectRatioLocked">
                                <i [class]="aspectRatioLocked ? 'fa-solid fa-link' : 'fa-solid fa-link-slash'"></i>
                            </button>

                            <!-- Height -->
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-600 mb-1">Height (px)</label>
                                <input type="number" [(ngModel)]="targetHeight" (ngModelChange)="onHeightChange()"
                                    class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg font-medium"
                                    min="1" max="10000">
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <p class="text-sm text-gray-500">
                                <i [class]="aspectRatioLocked ? 'fa-solid fa-lock' : 'fa-solid fa-lock-open'"
                                    class="mr-1"></i>
                                Aspect ratio {{ aspectRatioLocked ? 'locked' : 'unlocked' }}
                                <span class="ml-2 text-purple-600 font-medium">Scale: {{ getScaleFactor() }}</span>
                            </p>
                        </div>
                    </div>

                    <!-- Resize Mode Selection -->
                    @if (showResizeModes) {
                    <div class="bg-blue-50 rounded-xl p-6">
                        <h3 class="font-bold text-gray-800 mb-4">
                            <i class="fa-solid fa-crop-simple text-blue-500 mr-2"></i>
                            How to fit image?
                        </h3>
                        <div class="grid grid-cols-3 gap-4">
                            <!-- Stretch -->
                            <button (click)="setResizeMode('stretch')"
                                class="p-4 rounded-xl border-2 transition-all text-center"
                                [class.border-purple-500]="resizeMode === 'stretch'"
                                [class.bg-purple-50]="resizeMode === 'stretch'"
                                [class.border-gray-200]="resizeMode !== 'stretch'"
                                [class.bg-white]="resizeMode !== 'stretch'">
                                <div
                                    class="w-full aspect-video bg-gray-200 rounded-lg mb-3 flex items-center justify-center overflow-hidden">
                                    <div class="w-full h-full bg-blue-100 flex items-center justify-center">
                                        <i class="fa-solid fa-arrows-left-right-to-line text-blue-400 text-2xl"></i>
                                    </div>
                                </div>
                                <div class="flex items-center justify-center gap-2">
                                    <div class="w-4 h-4 rounded-full border-2"
                                        [class.border-purple-500]="resizeMode === 'stretch'"
                                        [class.bg-purple-500]="resizeMode === 'stretch'"
                                        [class.border-gray-300]="resizeMode !== 'stretch'"></div>
                                    <span class="font-medium text-gray-700">Stretch</span>
                                </div>
                            </button>

                            <!-- Crop -->
                            <button (click)="setResizeMode('crop')"
                                class="p-4 rounded-xl border-2 transition-all text-center"
                                [class.border-purple-500]="resizeMode === 'crop'"
                                [class.bg-purple-50]="resizeMode === 'crop'"
                                [class.border-gray-200]="resizeMode !== 'crop'"
                                [class.bg-white]="resizeMode !== 'crop'">
                                <div
                                    class="w-full aspect-video bg-gray-200 rounded-lg mb-3 flex items-center justify-center overflow-hidden">
                                    <div
                                        class="w-3/4 h-full bg-blue-100 flex items-center justify-center border-2 border-dashed border-blue-300">
                                        <i class="fa-solid fa-crop text-blue-400 text-2xl"></i>
                                    </div>
                                </div>
                                <div class="flex items-center justify-center gap-2">
                                    <div class="w-4 h-4 rounded-full border-2"
                                        [class.border-purple-500]="resizeMode === 'crop'"
                                        [class.bg-purple-500]="resizeMode === 'crop'"
                                        [class.border-gray-300]="resizeMode !== 'crop'"></div>
                                    <span class="font-medium text-gray-700">Crop</span>
                                </div>
                            </button>

                            <!-- Fit -->
                            <button (click)="setResizeMode('fit')"
                                class="p-4 rounded-xl border-2 transition-all text-center"
                                [class.border-purple-500]="resizeMode === 'fit'"
                                [class.bg-purple-50]="resizeMode === 'fit'"
                                [class.border-gray-200]="resizeMode !== 'fit'" [class.bg-white]="resizeMode !== 'fit'">
                                <div
                                    class="w-full aspect-video bg-gray-800 rounded-lg mb-3 flex items-center justify-center overflow-hidden">
                                    <div class="w-2/3 h-3/4 bg-blue-100 rounded flex items-center justify-center">
                                        <i class="fa-solid fa-compress text-blue-400 text-xl"></i>
                                    </div>
                                </div>
                                <div class="flex items-center justify-center gap-2">
                                    <div class="w-4 h-4 rounded-full border-2"
                                        [class.border-purple-500]="resizeMode === 'fit'"
                                        [class.bg-purple-500]="resizeMode === 'fit'"
                                        [class.border-gray-300]="resizeMode !== 'fit'"></div>
                                    <span class="font-medium text-gray-700">Fit</span>
                                </div>
                            </button>
                        </div>

                        <!-- Background color for Fit mode -->
                        @if (resizeMode === 'fit') {
                        <div class="mt-4 flex items-center gap-3">
                            <label class="text-sm font-medium text-gray-600">Background Color:</label>
                            <input type="color" [(ngModel)]="fitBackgroundColor"
                                class="w-10 h-10 rounded cursor-pointer border-0">
                            <span class="text-sm text-gray-500">{{ fitBackgroundColor }}</span>
                        </div>
                        }

                        <!-- Info about positioning for Crop/Fit -->
                        @if (resizeMode === 'crop' || resizeMode === 'fit') {
                        <div class="mt-4 bg-purple-100 text-purple-700 text-sm px-4 py-3 rounded-lg">
                            <i class="fa-solid fa-hand-pointer mr-2"></i>
                            Click "Resize" to open the position editor where you can drag the image to adjust its
                            position.
                        </div>
                        }
                    </div>
                    }

                    <!-- AI Upscale Option -->
                    @if (isUpscaling) {
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-2 rounded-xl p-5"
                        [class.border-purple-400]="useAiUpscale" [class.border-gray-200]="!useAiUpscale">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div
                                    class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                                    <i class="fa-solid fa-wand-magic-sparkles text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800">AI Upscale (Recommended)</h4>
                                    <p class="text-sm text-gray-500">Use Real-ESRGAN AI for high-quality enlargement</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" [(ngModel)]="useAiUpscale" class="sr-only peer">
                                <div
                                    class="w-14 h-7 bg-gray-200 peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-purple-500">
                                </div>
                            </label>
                        </div>

                        @if (useAiUpscale) {
                        <div class="mt-3 text-sm text-purple-700 bg-purple-100 rounded-lg p-3">
                            <i class="fa-solid fa-info-circle mr-1"></i>
                            AI will enhance details while upscaling. Processing takes 30-60 seconds.
                        </div>
                        }
                    </div>
                    }

                    <!-- Preset Sizes -->
                    <div>
                        <h3 class="font-bold text-gray-800 mb-3">Quick Presets</h3>
                        <div class="flex flex-wrap gap-2">
                            @for (preset of presets; track preset.name) {
                            <button (click)="applyPreset(preset)"
                                class="px-4 py-2 bg-gray-100 hover:bg-purple-100 hover:text-purple-700 rounded-lg text-sm font-medium transition-colors">
                                {{ preset.name }}
                                <span class="text-gray-400 ml-1">({{ preset.width }}×{{ preset.height }})</span>
                            </button>
                            }
                        </div>
                    </div>

                    <!-- Preview -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Original Preview -->
                        <div class="text-center">
                            <h4 class="font-bold text-gray-700 mb-2">
                                <i class="fa-solid fa-image text-gray-400 mr-2"></i>Original
                            </h4>
                            <div class="border border-gray-200 rounded-lg overflow-hidden bg-gray-100 p-2">
                                <img [src]="originalImage" class="max-w-full max-h-64 mx-auto object-contain">
                            </div>
                            <p class="text-sm text-gray-500 mt-2">{{ formatDimensions(originalWidth, originalHeight) }}
                            </p>
                        </div>

                        <!-- Resized Preview -->
                        <div class="text-center">
                            <h4 class="font-bold text-gray-700 mb-2">
                                <i class="fa-solid fa-check-circle text-purple-500 mr-2"></i>Resized
                                @if (useAiUpscale && isUpscaling) {
                                <span class="text-xs bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full ml-1">AI
                                    Enhanced</span>
                                }
                                @if (showResizeModes && resizeMode !== 'stretch') {
                                <span
                                    class="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full ml-1 capitalize">{{
                                    resizeMode }}</span>
                                }
                            </h4>
                            <div
                                class="border border-gray-200 rounded-lg overflow-hidden bg-gray-100 p-2 min-h-[200px] flex items-center justify-center">
                                @if (resizedImage) {
                                <img [src]="resizedImage" class="max-w-full max-h-64 mx-auto object-contain">
                                } @else if (isProcessing) {
                                <div class="text-center">
                                    @if (useAiUpscale && isUpscaling) {
                                    <i
                                        class="fa-solid fa-wand-magic-sparkles text-purple-500 text-3xl mb-2 animate-pulse"></i>
                                    <p class="text-gray-500">AI Upscaling...</p>
                                    <p class="text-xs text-gray-400">This may take 30-60 seconds</p>
                                    } @else {
                                    <i class="fa-solid fa-circle-notch fa-spin text-purple-500 text-3xl mb-2"></i>
                                    <p class="text-gray-500">Resizing...</p>
                                    }
                                </div>
                                } @else {
                                <div class="text-gray-400">
                                    <i class="fa-solid fa-arrow-up text-2xl mb-2"></i>
                                    <p class="text-sm">Click "Resize" to preview</p>
                                </div>
                                }
                            </div>
                            <p class="text-sm text-purple-600 mt-2 font-medium">{{ formatDimensions(targetWidth,
                                targetHeight) }}</p>
                        </div>
                    </div>

                    <!-- Error Message -->
                    @if (error) {
                    <div class="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg">
                        <i class="fa-solid fa-circle-exclamation mr-2"></i>{{ error }}
                    </div>
                    }

                    <!-- Action Buttons -->
                    <div class="flex flex-col md:flex-row gap-4 justify-center pt-4 items-center">
                        @if (!resizedImage) {
                        <button (click)="openPositionEditor()"
                            [disabled]="isProcessing || targetWidth <= 0 || targetHeight <= 0"
                            class="px-8 py-3 bg-gradient-to-r from-purple-500 to-violet-500 text-white rounded-xl font-bold shadow-lg shadow-purple-200 hover:from-purple-600 hover:to-violet-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2">
                            @if (useAiUpscale && isUpscaling) {
                            <i class="fa-solid fa-wand-magic-sparkles"></i>
                            {{ isProcessing ? 'AI Processing...' : 'AI Resize Image' }}
                            } @else {
                            <i class="fa-solid fa-expand"></i>
                            {{ isProcessing ? 'Resizing...' : 'Resize Image' }}
                            }
                        </button>
                        }

                        @if (resizedImage) {
                        <button (click)="downloadResized()"
                            class="flex-1 w-full md:w-auto px-8 py-3 bg-green-500 text-white rounded-xl font-bold shadow-lg shadow-green-200 hover:bg-green-600 transition-all flex items-center justify-center gap-2">
                            <i class="fa-solid fa-download"></i>
                            Download Resized
                        </button>

                        <button (click)="openPositionEditor()"
                            class="flex-1 w-full md:w-auto px-6 py-3 bg-purple-100 text-purple-700 rounded-xl font-bold hover:bg-purple-200 transition-colors flex items-center justify-center gap-2">
                            <i class="fa-solid fa-rotate"></i>
                            Resize Again
                        </button>

                        <!-- Send to Tool Button -->
                        <div class="w-full md:w-auto md:flex-1">
                            <app-send-to-tool [hasOutput]="!!resizedImage" [currentRoute]="currentRoute"
                                [outputData]="resizedImage || ''" [fileName]="originalFileName" [fileType]="'image'">
                            </app-send-to-tool>
                        </div>
                        }

                        <button (click)="reset()"
                            class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-xmark"></i>
                            Start Over
                        </button>
                    </div>
                </div>
                }
            </div>
        </div>

        <!-- Info Cards -->
        <div class="mt-8 grid md:grid-cols-4 gap-4">
            <div class="bg-white p-5 rounded-xl shadow-sm text-center">
                <i class="fa-solid fa-hand-pointer text-purple-500 text-2xl mb-2"></i>
                <h4 class="font-bold text-gray-800">Drag to Position</h4>
                <p class="text-gray-500 text-sm">Manual image control</p>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-sm text-center">
                <i class="fa-solid fa-wand-magic-sparkles text-purple-500 text-2xl mb-2"></i>
                <h4 class="font-bold text-gray-800">AI Upscale</h4>
                <p class="text-gray-500 text-sm">Quality enlargement</p>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-sm text-center">
                <i class="fa-solid fa-crop text-purple-500 text-2xl mb-2"></i>
                <h4 class="font-bold text-gray-800">Crop & Fit</h4>
                <p class="text-gray-500 text-sm">Multiple modes</p>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-sm text-center">
                <i class="fa-solid fa-lock text-purple-500 text-2xl mb-2"></i>
                <h4 class="font-bold text-gray-800">Ratio Lock</h4>
                <p class="text-gray-500 text-sm">Keep proportions</p>
            </div>
        </div>
    </div>
</div>